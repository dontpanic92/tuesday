<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.14c0dd40a340ad0cd240.css" data-identity="gatsby-global-css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}@font-face{font-family:Source Code Pro;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/sourcecodepro/v14/HI_SiYsKILxRpg3hIP6sJ7fM7PqlPevT.ttf) format("truetype")}@font-face{font-family:Source Sans Pro;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xK3dSBYKcSV-LCoeQqfX1RYOo3qOK7g.ttf) format("truetype")}@font-face{font-family:Source Sans Pro;font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwlxdr.ttf) format("truetype")}html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}body{font-family:Source Sans Pro,sans-serif}code,pre{font-family:Source Code Pro,monospace}html{font-size:100%;line-height:1.45;overflow-y:auto}body{color:#2f353f}div.mermaid,h1,h2,h3,h4,h5,h6,img,ol,p,ul{margin:0 0 24px}h4,h5{margin-bottom:1.0875rem}h1,h2,h3,h4,h5,h6{color:#2f353f;line-height:1.1}h1,h2,h3,h4,h6{font-weight:400}h1{font-size:2.5rem}h2{font-size:1.73286rem}h3{font-size:1.4427rem}h4{font-size:1.125rem;font-weight:700}h5,li,p{font-size:1rem}h6{font-size:.875rem}li,p{line-height:1.7}li li{font-size:1.05rem;line-height:1.4}ol,ul{margin-left:24px;padding:0}li{margin-bottom:12px}li>ol,li>ul{margin-top:12px}blockquote{border-left:2px solid #3f20ba;margin-left:0;padding:12px 20px}blockquote>ol,blockquote>p,blockquote>ul{font-size:inherit}blockquote>ol:last-child,blockquote>p:last-child,blockquote>ul:last-child{margin-bottom:0}blockquote li,td li{font-size:inherit;line-height:1.1}form{margin-bottom:0}hr{background-color:#dee2e7;border:none;height:1px;margin-bottom:23px}img.screenshot{border-radius:8px;box-shadow:0 0 0 1px rgba(18,21,26,.04),0 1px 4px 0 rgba(0,0,0,.08)}.gatsby-code-title{align-items:center;color:#5a6270;display:flex;font-family:Source Code Pro,monospace;font-size:15px;height:37px;margin-bottom:-37px;padding-left:19px}.gatsby-highlight-code-line{background-color:#ebeef0;display:block;margin-left:-3.5em;margin-right:-1em;padding-left:3.5em;padding-right:1em}.gatsby-highlight pre[class*=language-]{background-color:transparent;float:left;margin:0;min-width:100%;overflow:initial;padding:0}.gatsby-highlight pre[class*=language-].line-numbers{padding-left:2.5em}.gatsby-highlight pre[class*=language-].line-numbers .line-numbers-rows{border-right:none}.gatsby-highlight pre[class*=language-].line-numbers .line-numbers-rows>span:before{color:#cad0d8}code[class*=language-],pre[class*=language-]{color:#2f353f;direction:ltr;font-family:Source Code Pro,monospace;font-size:15px;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:none;white-space:pre;word-break:normal;word-spacing:normal}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{background:#f4f6f8;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-]{background:#ebeef0;border-radius:.3em;color:#f25cc1;font-size:.9em;padding:.1em .15em}.namespace{opacity:.7}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#959daa}.token.punctuation{color:#5a6270}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#f25cc1}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#26a29d}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:transparent;color:inherit}.token.atrule,.token.attr-value,.token.keyword{color:#3f20ba}.token.class-name,.token.function{color:#f25cc1}.token.important,.token.regex,.token.variable{color:#f4d03f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}pre[class*=language-]>code[class*=language-],pre[data-line]{position:relative}pre[class*=language-].line-numbers{counter-reset:linenumber;padding-left:3.8em;position:relative}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{border-right:1px solid #999;font-size:100%;left:-3.8em;letter-spacing:-1px;pointer-events:none;position:absolute;top:0;-webkit-user-select:none;-ms-user-select:none;user-select:none;width:3em}.line-numbers-rows>span{counter-increment:linenumber;display:block}.line-numbers-rows>span:before{color:#999;content:counter(linenumber);display:block;padding-right:.8em;text-align:right}</style><meta name="generator" content="Gatsby 3.14.6"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true">三、可靠性、容错性和隔离性 - Tuesday.</title><link data-react-helmet="true" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Righteous"/><link data-react-helmet="true" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/><meta data-react-helmet="true" name="description" content="dontpanic 的技术专栏"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/><meta data-react-helmet="true" property="og:title" content="三、可靠性、容错性和隔离性"/><meta data-react-helmet="true" property="og:site_name" content="Tuesday."/><meta data-react-helmet="true" property="og:description" content="Reliability, Fault-Tolerance, and Isolation"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="三、可靠性、容错性和隔离性"/><meta data-react-helmet="true" name="twitter:description" content="Reliability, Fault-Tolerance, and Isolation"/><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link rel="icon" href="/favicon-32x32.png?v=5476ae749c7ba8c0b0961dea57fd8358" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=5476ae749c7ba8c0b0961dea57fd8358"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=5476ae749c7ba8c0b0961dea57fd8358"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=5476ae749c7ba8c0b0961dea57fd8358"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=5476ae749c7ba8c0b0961dea57fd8358"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=5476ae749c7ba8c0b0961dea57fd8358"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=5476ae749c7ba8c0b0961dea57fd8358"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=5476ae749c7ba8c0b0961dea57fd8358"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=5476ae749c7ba8c0b0961dea57fd8358"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 48)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><link as="script" rel="preload" href="/webpack-runtime-f03f468fb1185576d27a.js"/><link as="script" rel="preload" href="/framework-bcf4c1d2232a4f1b31b7.js"/><link as="script" rel="preload" href="/9598fa14-6a39ed586f092d891d9f.js"/><link as="script" rel="preload" href="/9f92645c-df813722f906b02fa9fd.js"/><link as="script" rel="preload" href="/app-c66c60eb1365ec78ff2e.js"/><link as="script" rel="preload" href="/component---gatsby-theme-apollo-docs-src-components-template-js-c0bfeb7a9d55823478d5.js"/><link as="fetch" rel="preload" href="/page-data/the-error-model/3-reliability-fault-tolerance-and-isolation/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1511030359.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2468095761.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/4121983877.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css 1ot73i">.css-1ot73i{position:-webkit-sticky;position:sticky;top:0;z-index:1;width:100%;color:#5A6270;background:#ffffff;border-width:0 0 1px 0;border-color:#DEE2E7;border-style:solid;height:48px;}</style><nav class="css-1ot73i e3whxbx6"><style data-emotion="css uv35fb">.css-uv35fb{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;max-width:1440px;margin:0 auto;height:100%;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-uv35fb e3whxbx5"><style data-emotion="css la7jcn">.css-la7jcn{list-style-type:none;margin:0 12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><ul class="css-la7jcn e3whxbx4"><style data-emotion="css x2y83o">.css-x2y83o{font-size:1rem;margin:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-x2y83o a{color:inherit;padding:4px 12px;-webkit-text-decoration:none;text-decoration:none;border-radius:4px;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;}.css-x2y83o a:hover{opacity:0.8;color:#3f20ba;background:#EBEEF0;}</style><li class="css-x2y83o e3whxbx3"><a href="/"><style data-emotion="css 1k3i00y">.css-1k3i00y{font-family:'Righteous';color:#2F353F;-webkit-background-clip:text;background-clip:text;mix-blend-mode:multiply;}</style><span class="css-1k3i00y e3whxbx1">Tuesday.</span></a></li><li class="css-x2y83o e3whxbx3"><a href="/">首页</a></li></ul><ul class="css-la7jcn e3whxbx4"><li class="css-x2y83o e3whxbx3"><a href="https://dontpanic.blog/" target="_blank" title="随笔博客"><style data-emotion="css vhc98e">.css-vhc98e{height:1.7rem;}</style><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="blog" class="svg-inline--fa fa-blog fa-fw  css-vhc98e e3whxbx2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M172.2 226.8c-14.6-2.9-28.2 8.9-28.2 23.8V301c0 10.2 7.1 18.4 16.7 22 18.2 6.8 31.3 24.4 31.3 45 0 26.5-21.5 48-48 48s-48-21.5-48-48V120c0-13.3-10.7-24-24-24H24c-13.3 0-24 10.7-24 24v248c0 89.5 82.1 160.2 175 140.7 54.4-11.4 98.3-55.4 109.7-109.7 17.4-82.9-37-157.2-112.5-172.2zM209 0c-9.2-.5-17 6.8-17 16v31.6c0 8.5 6.6 15.5 15 15.9 129.4 7 233.4 112 240.9 241.5.5 8.4 7.5 15 15.9 15h32.1c9.2 0 16.5-7.8 16-17C503.4 139.8 372.2 8.6 209 0zm.3 96c-9.3-.7-17.3 6.7-17.3 16.1v32.1c0 8.4 6.5 15.3 14.8 15.9 76.8 6.3 138 68.2 144.9 145.2.8 8.3 7.6 14.7 15.9 14.7h32.2c9.3 0 16.8-8 16.1-17.3-8.4-110.1-96.5-198.2-206.6-206.7z"></path></svg></a></li><li class="css-x2y83o e3whxbx3"><a href="https://dontpanic.blog/about" target="_blank" title="关于我"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="info-circle" class="svg-inline--fa fa-info-circle fa-fw  css-vhc98e e3whxbx2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"></path></svg></a></li><li class="css-x2y83o e3whxbx3"><a href="https://github.com/dontpanic92/tuesday" target="_blank" title="本站源代码"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github-alt" class="svg-inline--fa fa-github-alt fa-fw  css-vhc98e e3whxbx2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path fill="currentColor" d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg></a></li><li class="css-x2y83o e3whxbx3"><a href="/license" title="协议：CC BY-NC-SA 4.0"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="creative-commons" class="svg-inline--fa fa-creative-commons fa-fw  css-vhc98e e3whxbx2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93-22.13 0-33.22 14.61-33.22 43.84 0 23.57 9.21 43.84 33.22 43.84 14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98-22.6 0-73.96-10.32-73.96-77.05 0-58.69 43-77.06 72.63-77.06 30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93-22.14 0-33.22 14.61-33.22 43.84 0 23.55 9.23 43.84 33.22 43.84 14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98-22.69 0-73.96-9.87-73.96-77.05 0-58.67 42.97-77.06 72.63-77.06 30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248 129.93 0 248.44-100.87 248.44-248 0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81 0-105.42 85.43-203.27 203.72-203.27 112.53 0 202.82 89.46 202.82 203.26-.01 121.69-99.68 202.82-202.84 202.82z"></path></svg></a></li></ul></div></nav><style data-emotion="css 1h2z9rg">.css-1h2z9rg{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;min-height:calc(100vh - 48px);max-width:1440px;margin:0 auto;}</style><div class="css-1h2z9rg exdt29b0"><style data-emotion="css 1226uca">.css-1226uca{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:312px;height:calc(100vh - 48px);padding:24px;overflow-y:auto;position:-webkit-sticky;position:sticky;top:48px;}@media (max-width: 850px){.css-1226uca{height:100%;background-color:white;box-shadow:0 0 48px rgba(0,0,0,0.25);position:fixed;z-index:2;opacity:0;visibility:hidden;-webkit-transform:translateX(-100%);-moz-transform:translateX(-100%);-ms-transform:translateX(-100%);transform:translateX(-100%);transition-property:transform,opacity,visibility;transition-duration:150ms;transition-timing-function:ease-in-out;}}</style><aside class="css-1226uca ezgpdot2"><style data-emotion="css 1p14ewn">.css-1p14ewn{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:24px;}</style><div class="css-1p14ewn ezgpdot1"><style data-emotion="css gbkvvb">.css-gbkvvb{color:#2F353F;-webkit-text-decoration:none;text-decoration:none;}</style><a href="/" class="css-gbkvvb ezgpdot0"><style data-emotion="css 135j8ps">.css-135j8ps{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:24px;}</style><div class="css-135j8ps eetev6l1"></div></a></div><div class="sidebar"><style data-emotion="css 18y74nd">.css-18y74nd{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin-bottom:32px;}</style><span class="css-18y74nd efh8xek1"><style data-emotion="css n6fyyw">.css-n6fyyw{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:40px;}</style><div class="css-n6fyyw e19uvsm15"><style data-emotion="css s5xdrg">.css-s5xdrg{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-s5xdrg e19uvsm10"><style data-emotion="css yx4e1e">.css-yx4e1e{width:1.5rem;height:1.5rem;margin:0;}</style><img src="/avatar.png" class="css-yx4e1e e19uvsm12"/><style data-emotion="css u85vmk">.css-u85vmk{margin:0 0 0 10px;font-size:1.125rem;}</style><span class="css-u85vmk e19uvsm11">dontpanic 的技术专栏</span></div></div></span><style data-emotion="css n8z9jl">.css-n8z9jl{margin-left:36px;margin-bottom:32px;list-style:none;}</style><ul class="css-n8z9jl ea7mcww6"></ul><div><style data-emotion="css 18f7tla">.css-18f7tla{position:relative;z-index:0;}.css-18f7tla .ea7mcww6{position:relative;z-index:2;}</style><div class="css-18f7tla ea7mcww4"><style data-emotion="css 1f4tdju">.css-1f4tdju{height:100%;width:100%;cursor:pointer;position:absolute;top:0;left:0;opacity:0;z-index:1;}.css-1f4tdju:hover~.ea7mcww3{opacity:0.8;}.css-1f4tdju:not(:checked)~ .ea7mcww3 svg{-webkit-transform:rotate(-90deg);-moz-transform:rotate(-90deg);-ms-transform:rotate(-90deg);transform:rotate(-90deg);}.css-1f4tdju:not(:checked)~ .ea7mcww6{display:none;}</style><input type="checkbox" value="山海狂心：仙古轩系列游戏逆向研究" class="css-1f4tdju ea7mcww1" checked=""/><style data-emotion="css a7yzoi">.css-a7yzoi{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:12px 0;color:#2F353F;font-weight:bold;text-transform:uppercase;}.css-a7yzoi svg{margin-right:10px;height:10px;width:10px;}.css-a7yzoi.active{color:#3f20ba;}</style><div class="css-a7yzoi ea7mcww3"><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M23.25 7.311L12.53 18.03a.749.749 0 0 1-1.059.001l-.001-.001L.75 7.311"></path></svg>山海狂心：仙古轩系列游戏逆向研究</div><ul class="css-n8z9jl ea7mcww6"><style data-emotion="css r6fr8v">.css-r6fr8v{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:0.95rem;line-height:1.5;margin-bottom:13px;}.css-r6fr8v a{color:inherit;-webkit-text-decoration:none;text-decoration:none;padding:3px 10px;margin:-3px -10px;border-radius:4px;}.css-r6fr8v a:hover{opacity:0.8;}.css-r6fr8v a.active{color:#3f20ba;pointer-events:none;font-weight:600;background:#F4F6F8;}</style><li class="css-r6fr8v ea7mcww5"><a title="Preface" href="/xgx-research/0-preface/">〇、前言</a></li><li class="css-r6fr8v ea7mcww5"><a title="CPK Packaging Format" href="/xgx-research/1-cpk/">一、打包格式 CPK</a></li><li class="css-r6fr8v ea7mcww5"><a title="FMB Packaging Format" href="/xgx-research/2-fmb/">二、打包格式 FMB</a></li><li class="css-r6fr8v ea7mcww5"><a title="IMD Packaging Format" href="/xgx-research/3-imd/">三、打包格式 IMD</a></li></ul></div><div class="css-18f7tla ea7mcww4"><input type="checkbox" value="栈缓冲区溢出 101" class="css-1f4tdju ea7mcww1" checked=""/><div class="css-a7yzoi ea7mcww3"><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M23.25 7.311L12.53 18.03a.749.749 0 0 1-1.059.001l-.001-.001L.75 7.311"></path></svg>栈缓冲区溢出 101</div><ul class="css-n8z9jl ea7mcww6"><li class="css-r6fr8v ea7mcww5"><a href="https://ctf.dontpanic.blog/notes/stack-buffer-overflow-101.html" target="_blank" rel="noopener noreferrer">一、栈缓冲区溢出 101<style data-emotion="css 1dl06o9">.css-1dl06o9{height:14px;width:14px;vertical-align:-1px;margin-left:8px;color:#959DAA;}</style><style data-emotion-css="qic6h7">.css-qic6h7{overflow:visible;height:25px;}.css-qic6h7 *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 25 25" style="height:1rem" class="css-1dl06o9 ea7mcww0 css-qic6h7"><path fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12.141 4.894H3.576A1.977 1.977 0 0 0 1.6 6.871v14.494c0 1.09.885 1.976 1.976 1.976h14.495a1.977 1.977 0 0 0 1.976-1.976V12.8M17.412 1.6h4.94a.99.99 0 0 1 .99.988V7.53m-10.883 4.952L23.05 1.89"></path></svg></a></li><li class="css-r6fr8v ea7mcww5"><a href="https://ctf.dontpanic.blog/notes/stack-buffer-overflow-aslr.html" target="_blank" rel="noopener noreferrer">二、ASLR<style data-emotion-css="qic6h7">.css-qic6h7{overflow:visible;height:25px;}.css-qic6h7 *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 25 25" style="height:1rem" class="css-1dl06o9 ea7mcww0 css-qic6h7"><path fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12.141 4.894H3.576A1.977 1.977 0 0 0 1.6 6.871v14.494c0 1.09.885 1.976 1.976 1.976h14.495a1.977 1.977 0 0 0 1.976-1.976V12.8M17.412 1.6h4.94a.99.99 0 0 1 .99.988V7.53m-10.883 4.952L23.05 1.89"></path></svg></a></li><li class="css-r6fr8v ea7mcww5"><a href="https://ctf.dontpanic.blog/notes/stack-buffer-overflow-canary.html" target="_blank" rel="noopener noreferrer">三、Security Cookie / Canary<style data-emotion-css="qic6h7">.css-qic6h7{overflow:visible;height:25px;}.css-qic6h7 *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 25 25" style="height:1rem" class="css-1dl06o9 ea7mcww0 css-qic6h7"><path fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12.141 4.894H3.576A1.977 1.977 0 0 0 1.6 6.871v14.494c0 1.09.885 1.976 1.976 1.976h14.495a1.977 1.977 0 0 0 1.976-1.976V12.8M17.412 1.6h4.94a.99.99 0 0 1 .99.988V7.53m-10.883 4.952L23.05 1.89"></path></svg></a></li></ul></div><div class="css-18f7tla ea7mcww4"><input type="checkbox" value="错误模型" class="css-1f4tdju ea7mcww1" checked=""/><div class="active css-a7yzoi ea7mcww3"><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M23.25 7.311L12.53 18.03a.749.749 0 0 1-1.059.001l-.001-.001L.75 7.311"></path></svg>错误模型</div><ul class="css-n8z9jl ea7mcww6"><li class="css-r6fr8v ea7mcww5"><a title="Introduction" href="/the-error-model/0-introduction/">〇、错误模型简介</a></li><li class="css-r6fr8v ea7mcww5"><a title="Ambitions and Learnings" href="/the-error-model/1-ambitions-and-learnings/">一、野心和经验</a></li><li class="css-r6fr8v ea7mcww5"><a title="Bugs Aren’t Recoverable Errors!" href="/the-error-model/2-bugs-arent-recoverable-errors/">二、Bug 不是可恢复错误！</a></li><li class="css-r6fr8v ea7mcww5"><a aria-current="page" class="active" title="Reliability, Fault-Tolerance, and Isolation" href="/the-error-model/3-reliability-fault-tolerance-and-isolation/">三、可靠性、容错性和隔离性</a></li><li class="css-r6fr8v ea7mcww5"><a title="Bugs: Abandonment, Assertions, and Contracts" href="/the-error-model/4-bugs-abandonment-assertions-and-contracts/">四、Bugs：放弃、断言和合约</a></li><li class="css-r6fr8v ea7mcww5"><a title="Recoverable Errors: Type-Directed Exceptions" href="/the-error-model/5-ecoverable-errors-type-directed-exceptions/">五、可恢复错误：类型导向的异常</a></li><li class="css-r6fr8v ea7mcww5"><a title="Retrospective and Conclusions" href="/the-error-model/6-retrospective-and-conclusions/">六、回顾和总结</a></li></ul></div><div class="css-18f7tla ea7mcww4"><input type="checkbox" value="公共语言运行时" class="css-1f4tdju ea7mcww1" checked=""/><div class="css-a7yzoi ea7mcww3"><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M23.25 7.311L12.53 18.03a.749.749 0 0 1-1.059.001l-.001-.001L.75 7.311"></path></svg>公共语言运行时</div><ul class="css-n8z9jl ea7mcww6"><li class="css-r6fr8v ea7mcww5"><a href="/botr/1-introduction/">一、CLR 简介</a></li><li class="css-r6fr8v ea7mcww5"><a href="/botr/2-garbage-collection/">二、CLR 垃圾回收器的设计</a></li><li class="css-r6fr8v ea7mcww5"><a href="/botr/6-type-loader/">六、CLR 类型加载器的设计</a></li></ul></div></div></div></aside><style data-emotion="css 1ff36h2">.css-1ff36h2{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><main class="css-1ff36h2 efh8xek6"><style data-emotion="css 1ip6okp">.css-1ip6okp{position:-webkit-sticky;position:sticky;top:0;left:0;z-index:1;}</style><header class="css-1ip6okp edldhn51"><style data-emotion="css xc8ji6">.css-xc8ji6{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:0;padding:0 56px;background-color:white;}@media (max-width: 850px){.css-xc8ji6{padding:0 24px;}}</style><div class="css-xc8ji6 edldhn50"><style data-emotion="css 8jbk1d">.css-8jbk1d{display:none;}@media (max-width: 850px){.css-8jbk1d{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-right:32px;color:#2F353F;}}</style><div class="css-8jbk1d efh8xek2"><style data-emotion="css 1m6zll5">.css-1m6zll5{padding:20px;margin-left:-20px;color:inherit;border:none;background:none;outline:none;cursor:pointer;}</style><button class="css-1m6zll5 e1qf1exz1"><style data-emotion="css 1ihqbbj">.css-1ihqbbj{height:24px;width:24px;display:block;fill:currentColor;}</style><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1ihqbbj e1qf1exz0 css-1a134qk"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M2.25 18.003h19.5M2.25 12.003h19.5M2.25 6.003h19.5"></path></g></svg></button></div></div></header><style data-emotion="css-global q9286l">html{scroll-padding-top:68px;}</style><style data-emotion="css ip9jqt">.css-ip9jqt{padding:40px 56px;padding-bottom:0;}@media (max-width: 850px){.css-ip9jqt{padding:32px 48px;}}@media (max-width: 600px){.css-ip9jqt{padding:24px 32px;}}</style><div class="css-ip9jqt ernxcdh2"><div class="header-wrapper"><style data-emotion="css cz947x">.css-cz947x:not(:last-child){margin-bottom:8px;}</style><h1 class="css-cz947x ei8t6h41">三、可靠性、容错性和隔离性</h1><style data-emotion="css kfq87l">.css-kfq87l{color:#5A6270;}</style><h3 class="css-kfq87l ei8t6h40">Reliability, Fault-Tolerance, and Isolation</h3><style data-emotion="css 1krv50g">.css-1krv50g{margin-bottom:20px;max-height:280px;}</style><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained css-1krv50g ei8t6h42"><div style="max-width:1440px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;720&#x27; width=&#x27;1440&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="/static/ac982c968177cf6bf72d4c6b4fa920b6/e02de/cover.webp 360w,/static/ac982c968177cf6bf72d4c6b4fa920b6/4c661/cover.webp 720w,/static/ac982c968177cf6bf72d4c6b4fa920b6/0a83a/cover.webp 1440w" sizes="(min-width: 1440px) 1440px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1440px) 1440px, 100vw" decoding="async" loading="lazy" data-src="/static/ac982c968177cf6bf72d4c6b4fa920b6/6a249/cover.jpg" data-srcset="/static/ac982c968177cf6bf72d4c6b4fa920b6/11ab8/cover.jpg 360w,/static/ac982c968177cf6bf72d4c6b4fa920b6/c9a94/cover.jpg 720w,/static/ac982c968177cf6bf72d4c6b4fa920b6/6a249/cover.jpg 1440w" alt="Cover Image"/></picture><noscript><picture><source type="image/webp" srcSet="/static/ac982c968177cf6bf72d4c6b4fa920b6/e02de/cover.webp 360w,/static/ac982c968177cf6bf72d4c6b4fa920b6/4c661/cover.webp 720w,/static/ac982c968177cf6bf72d4c6b4fa920b6/0a83a/cover.webp 1440w" sizes="(min-width: 1440px) 1440px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1440px) 1440px, 100vw" decoding="async" loading="lazy" src="/static/ac982c968177cf6bf72d4c6b4fa920b6/6a249/cover.jpg" srcSet="/static/ac982c968177cf6bf72d4c6b4fa920b6/11ab8/cover.jpg 360w,/static/ac982c968177cf6bf72d4c6b4fa920b6/c9a94/cover.jpg 720w,/static/ac982c968177cf6bf72d4c6b4fa920b6/6a249/cover.jpg 1440w" alt="Cover Image"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div></div><hr/><style data-emotion="css 1o129hd">.css-1o129hd{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}</style><div class="css-1o129hd e694h6z7"><style data-emotion="css a181dj">.css-a181dj{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;width:0;}.css-a181dj .api-ref h4 code{font-size:1.1em;}.css-a181dj .api-ref *:not(pre)>code[class*="language-"]{padding:0;background:none;}</style><div class="css-a181dj e694h6z6"><style data-emotion="css sk9651">.css-sk9651 a[href]:not([class]){color:#2075d6;-webkit-text-decoration:none;text-decoration:none;}.css-sk9651 a[href]:not([class]):hover{-webkit-text-decoration:underline;text-decoration:underline;}.css-sk9651 a[href]:not([class]) code{color:inherit;}.css-sk9651 h1 code,.css-sk9651 h2 code,.css-sk9651 h3 code,.css-sk9651 h4 code,.css-sk9651 h5 code,.css-sk9651 h6 code{white-space:normal;}.css-sk9651 h1 a,.css-sk9651 h2 a,.css-sk9651 h3 a,.css-sk9651 h4 a,.css-sk9651 h5 a,.css-sk9651 h6 a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-sk9651 h1 a:hover,.css-sk9651 h2 a:hover,.css-sk9651 h3 a:hover,.css-sk9651 h4 a:hover,.css-sk9651 h5 a:hover,.css-sk9651 h6 a:hover{color:#5A6270;}.css-sk9651 *:not(style)+ h2,.css-sk9651 *:not(style)+ h3,.css-sk9651 *:not(style)+ h4,.css-sk9651 *:not(style)+ h5{margin-top:64px;}.css-sk9651 img{display:block;max-width:100%;}.css-sk9651 .mermaid svg{max-width:100%;}</style><div class="content-wrapper css-sk9651 e694h6z5"><div><p>在继续下一个话题之前，我们需要明确的是：<del>猫咪总是四脚朝地</del> 故障（Failure）总是会发生的。</p>
<h2 id="如何构建一个可靠的系统" style="position:relative"><a class="headingLink" href="#如何构建一个可靠的系统">如何构建一个可靠的系统</a></h2>
<p>大家通常认为，一个可靠的系统就是能够系统性地证明故障不可能发生。直觉上看，似乎很对。但它存在一个问题：在有限的条件下，这是不可能的。如果你能在可靠性这一点上花上上亿美刀，情况也许会有所改观；此外，也可以使用像 <a href="https://en.wikipedia.org/wiki/SPARK_%28programming_language%29" target="_blank" rel="noopener noreferrer">SPARK</a> （基于合约（Contracts）的 Ada 扩展）之类的语言来形式化地证明每行代码的正确性。然而，<a href="https://en.wikipedia.org/wiki/List_of_software_bugs" target="_blank" rel="noopener noreferrer">经验表明</a>这种方法也不是万无一失。</p>
<p>我们选择了接受这种现状。当然，我们必须尽可能地减少故障的发生，错误模型必须能够让故障透明化，并且易于处理。但是更重要的是，你需要在系统设计上下功夫，使得就算某个部分出现了问题，整个系统也还能够工作；同时还要让系统能够优雅地恢复出错的部分。这其实在分布式系统中是常识，有什么特别之处吗？</p>
<p>一切的前提是，我们要把一个操作系统看作是各个协作进程组成的分布式网络，就像由微服务组成的分布式集群、或是互联网本身一样。主要的差别包括延迟、信任级别、关于位置、身份的各种假设，等等。在一个高度异步的、分布式的、IO密集的系统中，故障是必然发生的。我的印象是，在很大程度上，由于宏内核的成功，我们还没有实现“操作系统作为一个分布式系统”的飞跃。然而，一旦你这样看待一个操作系统，很多设计准则都会发生改变。</p>
<p>在大多数分布式系统中，系统架构都会认为一个进程发生故障是不可避免的。从而我们需要花大力气来避免级联故障，定期记录日志，并且将程序和服务设计为允许重新启动的。</p>
<p>一旦你接受了这样的设定，很多事情都变得不一样了。</p>
<p>举个例子，隔离性就变得极端重要。Midori 的进程模型鼓励轻量级、细粒度的隔离。结果就是，程序、甚至是现代操作系统中的“线程”之间都是独立分隔的实体。相比于在同一个地址空间中共享可修改的状态，这样的设计可以更容易地在某个实体发生故障时提供保护。</p>
<p>高隔离性同样有利于实现简洁性。Butler Lampson 的经典论文
<a href="https://research.microsoft.com/pubs/68221/acrobat.pdf" target="_blank" rel="noopener noreferrer">Hints on Computer System Design</a> 探索了这一方面。我非常喜欢 Hoare 的这句话：</p>
<blockquote>
<p>可靠性不可避免的代价就是简单化<br/>
C. Hoare</p>
</blockquote>
<blockquote>
<p>（译注：C. A. R. Hoare (或 Tony Hoare)，发明了快速排序、霍尔逻辑形式验证等算法和系统）</p>
</blockquote>
<p>通过把程序分成更小的部分，每一个部分都允许成功或失败，他们的状态管理可以变得更加简单。结果就是，从故障中恢复也变得更加容易。在我们的语言中，可能发生故障的地方都会显式说明，这进一步保证了内部状态机的正确性，同时能够点明哪些地方会与混乱的外部世界发生联系。在这个世界上，局部故障的代价并没有那么可怕。我并没有过分地重视这一点——架构方面提供的隔离性，是我后面描述的所有语言功能的基础。</p>
<p>Erlang 已经非常成功地把这种属性加入到了语言的基础部分。就像 Midori 一样，它使用了轻量级进程，通过消息传递互相连接，并且鼓励容错架构设计。一个通用的模式叫做“Supervisor”，有一些进程会负责监控和重启其他发生故障的进程。<a href="https://ferd.ca/the-zen-of-erlang.html" target="_blank" rel="noopener noreferrer">这篇文章</a>非常好地阐述了这种理念——“Let it crash”，同时还推荐了一些用来构建可靠的 Erlang 程序的实用技术。</p>
<p>关键之处并非是如何防止故障，而是知道如何应对故障。一旦这样的架构建立了起来，你就会相信它的确能够正常工作。对于我们来说，我们进行了长达一周的压力测试，以确保我们的系统在整体上足够稳定，即便在这期间某些进程可能会因为故障而崩溃、重启。这让我想起了类似于 Netflix 的 <a href="https://github.com/Netflix/SimianArmy/wiki/Chaos-Monkey" target="_blank" rel="noopener noreferrer">Chaos Monkey</a> 系统，它会随机杀掉集群中的某些机器来确保服务的运行状况良好。</p>
<p>随着分布式计算越来越流行，我很期待能够有更多人能够采用这样的思想。比如，在一个微服务的集群中，在单一容器上发生的故障通常能够被外部的集群管理软件无缝地处理（例如 Kubernetes、Amazon EC2 Container Service、Docker Swarm等等）。所以我这篇博客所描述的内容可能对写出可靠的 Java/Node.js/Javascript/Python/Ruby 服务有所帮助，但不幸的是你很可能需要跟你使用的语言作一番斗争。为了在出现问题时能够继续勉强工作，你可能需要写上一大堆的代码。</p>
<h2 id="放弃" style="position:relative"><a class="headingLink" href="#放弃">放弃</a></h2>
<p>就算进程很轻量、隔离得很好、重启很简单，仍然会有人认为遇到 bug 就直接结束进程的做法太过激进。这也是能够理解的。我就来试着说服你吧。</p>
<p>如果你想要构建一个健壮的系统，当遇到 bug 时选择继续执行是很危险的。如果一个程序员没有考虑过某些状况的发生，谁都不知道那些代码会不会继续正常工作。重要的数据也许已经被破坏成不正确的状态了。举一个极端（也许有点傻）的例子：某段程序本来是要对你的银行存款向下取整，现在却开始向上取整了。</p>
<p>也许你认为放弃的粒度应该更小，这就有点复杂了。举例来说，假如你的进程遇到了 bug 并且出现了故障，这个 bug 可能是由于某些静态变量的值出错导致的。尽管其他的线程看起来没问题，你也没办法笃定它们一定不会被影响。除非你的系统支持某些特性——比如语言提供的隔离性、各个独立线程中可访问的顶层对象的隔离性、等等，否则最安全的假设就是只能扔掉整个地址空间，其他的操作都是有风险、不可靠的。由于 Midori 中的进程非常轻量，放弃一个 Modiri 进程就像在其他的系统中放弃一个线程一样。我们的隔离模型能够确保这样做的可靠性。</p>
<p>我必须得承认，“放弃”范围的界定可能产生滑坡谬误。可能在世界上所有的数据都已经坏掉了，你怎么知道放弃这个进程就够了呢？这里有一个很明显的区别：进程的状态是提前设计好的、非持久化的。在一个设计良好的系统中，进程可以随时被丢弃然后重新创建。的确，一个 bug 可以破坏外部持久化的状态，但如果这种更严重的问题发生了的话，你就需要使用不同的方法来处理了。</p>
<p>我们可以看一看容错系统的设计来了解更多的背景。放弃（快速失败）在容错系统中已经是一个非常常见的技术了，我们也可以把这一领域的大多数经验应用到普通的程序和进程中。也许最重要的一点就是定期记录日志、定期在检查点记录宝贵的持久化状态。1985年 Jim Gray 的发表了一篇论文
<a href="https://citeseerx.ist.psu.edu/viewdoc/download%3Fdoi%3D10.1.1.110.9127%26rep%3Drep1%26type%3Dpdf" target="_blank" rel="noopener noreferrer">Why Do Computers Stop and What Can Be Done About It?</a> 详细地描述了这种观点。随着程序不断地迁入云服务、并且激进地划分为更小的、互相独立的服务，这种明确区分非持久化和持久化的状态越发显得重要起来。这种潮流也影响了软件的开发方式，如今“放弃”在现代架构中也变得更加容易实现。同时，放弃也有助于防止数据的损坏，因为 bug 在下一个检查点到来之前就会被检测到，程序也不会在错误状态下继续执行。</p>
<p>对于 Midori 内核中的 Bug，我们的处理方式有所不同。例如，微内核的 bug 相比于用户态进程的 bug 来说，破坏性更大，最安全的方法是放弃整个“域（Domain）”（即地址空间）。幸运的是，你所了解的大多数典型的“内核”功能——调度器、内存管理、文件管理、网络栈、甚至设备驱动——都在用户态以独立进程的方式执行。这些模块中的错误可以用上文中提到的通常方法解决。</p></div></div><style data-emotion="css 1f6gfyy">.css-1f6gfyy{display:none;margin-top:48px;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;}@media (max-width: 1120px){.css-1f6gfyy{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}@media (max-width: 850px){.css-1f6gfyy{display:none;}}@media (max-width: 600px){.css-1f6gfyy{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-top:24px;}}</style><div class="css-1f6gfyy e694h6z0"></div><style data-emotion="css 9ckfit">.css-9ckfit{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding:64px 0;}@media (max-width: 850px){.css-9ckfit{padding:32px 0;}}</style><nav class="css-9ckfit e1sfxy7w4"><style data-emotion="css spe9v1">.css-spe9v1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-spe9v1 svg{height:16px;width:16px;}.css-spe9v1:hover{opacity:0.8;}</style><a class="css-spe9v1 e1sfxy7w3" href="/the-error-model/2-bugs-arent-recoverable-errors/"><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 14 24" class="css-1a134qk"><path fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12.5.75L1.78 11.47a.749.749 0 0 0-.001 1.059l.001.001L12.5 23.25"></path></svg><style data-emotion="css 16mhdhi">.css-16mhdhi{margin-left:24px;text-align:left;}@media (max-width: 850px){.css-16mhdhi{margin-left:16px;}}</style><div class="css-16mhdhi e1sfxy7w2"><style data-emotion="css 1vhhq4p">.css-1vhhq4p{letter-spacing:0.142em;text-transform:uppercase;font-size:12px;}</style><div class="css-1vhhq4p e1sfxy7w1">Previous</div><style data-emotion="css mtbysh">.css-mtbysh{color:#2F353F;}</style><div class="css-mtbysh e1sfxy7w0">二、Bug 不是可恢复错误！</div></div></a><a style="margin-left:auto" class="css-spe9v1 e1sfxy7w3" href="/the-error-model/4-bugs-abandonment-assertions-and-contracts/"><style data-emotion="css 18eg9eb">.css-18eg9eb{margin-right:24px;text-align:right;}@media (max-width: 850px){.css-18eg9eb{margin-right:16px;}}</style><div class="css-18eg9eb e1sfxy7w2"><div class="css-1vhhq4p e1sfxy7w1">Next</div><div class="css-mtbysh e1sfxy7w0">四、Bugs：放弃、断言和合约</div></div><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5.5.75l10.72 10.72a.749.749 0 0 1 .001 1.059l-.001.001L5.5 23.25"></path></svg></a></nav><div id="comments-container"></div></div><style data-emotion="css 10vu48r">.css-10vu48r{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:240px;max-height:calc(100vh - 0px - 48px);margin-top:-36px;padding:40px 0;margin-left:40px;position:-webkit-sticky;position:sticky;top:48px;}@media (max-width: 1120px){.css-10vu48r{display:none;}}@media (max-width: 850px){.css-10vu48r{display:block;}}@media (max-width: 600px){.css-10vu48r{display:none;}}</style><aside class="css-10vu48r e694h6z4"><style data-emotion="css 16ceglb">.css-16ceglb{font-weight:600;}</style><h4 class="css-16ceglb e694h6z3">三、可靠性、容错性和隔离性</h4><style data-emotion="css gmdgof">.css-gmdgof{margin-left:0;margin-bottom:48px;overflow:auto;}</style><ul class="css-gmdgof e1wyoreh1"><style data-emotion="css 1h656g5">.css-1h656g5{list-style:none;font-size:1rem;line-height:inherit;}.css-1h656g5.active{color:#3f20ba;font-weight:bold;}.css-1h656g5 a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-1h656g5 a:hover{opacity:0.8;}</style><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#如何构建一个可靠的系统">如何构建一个可靠的系统</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#放弃">放弃</a></li></ul></aside></div></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-TZ8V0QY4Z8"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-TZ8V0QY4Z8', {"send_page_view":false});
      }
      </script><script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/the-error-model/3-reliability-fault-tolerance-and-isolation/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-4d7916b90c2acddcaec3.js"],"app":["/app-c66c60eb1365ec78ff2e.js"],"component---gatsby-theme-apollo-core-src-pages-404-js":["/component---gatsby-theme-apollo-core-src-pages-404-js-b66e7ee97587ae8b57e1.js"],"component---gatsby-theme-apollo-docs-src-components-template-js":["/component---gatsby-theme-apollo-docs-src-components-template-js-c0bfeb7a9d55823478d5.js"],"component---src-pages-index-mdx":["/component---src-pages-index-mdx-2ee0cebcb5cad657a921.js"],"component---src-pages-license-mdx":["/component---src-pages-license-mdx-5c19301acf098a931df1.js"]};/*]]>*/</script><script src="/polyfill-4d7916b90c2acddcaec3.js" nomodule=""></script><script src="/component---gatsby-theme-apollo-docs-src-components-template-js-c0bfeb7a9d55823478d5.js" async=""></script><script src="/app-c66c60eb1365ec78ff2e.js" async=""></script><script src="/9f92645c-df813722f906b02fa9fd.js" async=""></script><script src="/9598fa14-6a39ed586f092d891d9f.js" async=""></script><script src="/framework-bcf4c1d2232a4f1b31b7.js" async=""></script><script src="/webpack-runtime-f03f468fb1185576d27a.js" async=""></script></body></html>